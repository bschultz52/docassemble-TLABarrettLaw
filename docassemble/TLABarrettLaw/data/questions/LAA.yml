objects:
  - user: Individual
  - cohabs: DAList.using(object_type=Individual)
  - family_members: DAList.using(object_type=Individual, complete_attribute="assets")
---
mandatory: true
code: |
  # Code-flow block 
 
  user
  user.assets
  
  if (Received_Laa_Assistance == False):  
    In_Alberta
    Lives_In_Alberta
    Family_Matter
    Criminal_Matter
  if Cannot_Afford_Lawyer:
    No_Lawyer
    Lawyer_Is_Acting
    
 
---
mandatory: true
question: Results
subquestion:   |
  Hello, ${ user }.
  
  % if (user_eligible and user_qualifies) :
  Student Legal Services can 100000% rep you.
  
  % else:
  Sorry my friend, no SLS help for you.
  % endif
  
  Your assets are ${user.assets}, your income in the past 30 days was ${user.monthincome}, and your income in the past year was ${user.yearincome}.
                
  %for j in family_members:
  ${j} has ${j.assets} in assets, ${j.monthincome} in income in the past 30 days, and ${j.yearincome} in the past year.
   %endfor
        
   Your total monthly income was ${total_income_month}.
   Your total yearly income was ${total_income_year}.
attachments:
  - name: Summary of Benefits
    filename: benefits_summary
    content: |
      Hello, ${ user }.
       
       % if No_Lawyer:
      You currently do not have a Legal Representation
       % endif
       
       % if Cannot_Afford_Lawyer:
       You cannot currently afford legal representation.
       % endif
       
       % if Lawyer_Is_Acting:
       You are currently still represented by a lawyer.
       % endif
      
      % if In_Alberta: 
      Your legal matter is in Alberta.
      % endif
      
      % if Lives_In_Alberta:
      You are also currently living in Alberta.
      % endif
      
      % if Received_Laa_Assistance:
      You have received LAA Assitance on this matter in the past.
      % endif
      
      % if Criminal_Matter:
      This is a criminal law matter
      % endif
      
      % if Family_Matter:
      This is a family law matter
      % endif
      
      Your signature? ${ user.signature }
      
      All the best,
      Student Legal Services
---
code: |
  # Unrepped 
    
  if No_Lawyer and Cannot_Afford_Lawyer:
    user_not_reped = True 
  else: 
    user_not_reped = False
---
code: |
  # Resident  
    
  if In_Alberta and Lives_In_Alberta:
    user_resident = True 
  else:
    user_resident = False
---
code: |
  # Eligibility 
    
  if Received_Laa_Assistance or (user_not_reped and user_resident and Criminal_Matter) or (user_not_reped and user_resident and Family_Matter):
    user_eligible = True 
  else:
    user_eligible = False 
---
code: |
  total_income_month = user.monthincome
  for j in family_members:
    total_income_month += j.monthincome
---
code: |
  total_income_year = user.yearincome  
  for j in family_members:
    total_income_year += j.yearincome   
---
code: |
  family_size = len(family_members)
  if family_size > 6:
    family_size = 6
  eligible = False
  marginally_eligible = False
  ineligible = False
  maximum_income_month = [1668, 2066, 2940, 3178, 3416, 3655]
  maximum_income_year = [20021, 24788, 35275, 38134, 40995, 43855]
 
  if ((total_income_month <= maximum_income_month[family_size]) and (total_income_year <= maximum_income_year[family_size])):
    eligible = True
  elif ((total_income_month <= maximum_income_month[family_size]*1.1) and (total_income_year <= maximum_income_year[family_size]*1.1)):
    marginally_eligible = True
  else:
    ineligible = True
      
---
code: |
  # qualifies
  if (user_not_reped and user_resident and (eligible or marginally_eligible)):
    user_qualifies = True
  else:
    user_qualifies = False
---
generic object: Individual
question: |
  What is ${x.object_possessive('name') }?
fields:
  - First Name: x.name.first
  - Last Name: x.name.last
---
question: Do you have any family members?
yesno: family_members.there_are_any
---
question: Do you have any additional family members?
yesno: family_members.there_is_another
---
question: Do you live with anyone?
yesno: cohabs.there_are_any
---
question: Do you live with anyone else?
yesno: cohabs.there_is_another
--- 
question: Please sign
signature: user.signature
---
question: Do you have a lawyer?
noyes: No_Lawyer
---
question: Can you afford a lawyer?
noyes: Cannot_Afford_Lawyer
---
question: Is your lawyer still acting for you in this matter?
yesno: Lawyer_Is_Acting
---
question: Is your matter in Alberta?
yesno: In_Alberta
---
question: Do you live in Alberta?
yesno: Lives_In_Alberta
--- 
question: Is this a family law matter?
yesno: Family_Matter
---
question: Is this a criminal law matter?
yesno: Criminal_Matter
---
question: Is this an appeal of another LAA matter?
yesno: Received_Laa_Assistance
---
question: |
  Please enter the following information for ${family_members[i]}?
fields:
  - How much in assets do they own?: family_members[i].assets
    datatype: currency
  - What was their income in the last 30 days?: family_members[i].monthincome
    datatype: currency
  - What was their income in the last year?: family_members[i].yearincome
    datatype: currency
---
question: |
  Please enter the following information for ${user}?
fields:
  - How much in assets do you own?: user.assets
    datatype: currency
  - What was your income in the last 30 days?: user.monthincome
    datatype: currency
  - What was your income in the last year?: user.yearincome
    datatype: currency